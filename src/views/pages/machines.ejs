<% const bodyContent=`<section class="section">
  <div class="section-header">
    <h1>Máquinas Cadastradas</h1>
    <div class="section-header-button">
      <a href="features-post-create.html" class="btn btn-primary">Cadastrar Máquina</a>
    </div>
    <div class="section-header-breadcrumb">
      <div class="breadcrumb-item active"><a href="#">Dashboard</a></div>
      <div class="breadcrumb-item"><a href="#">Cadastros</a></div>
      <div class="breadcrumb-item">Máquinas Cadastradas</div>
    </div>
  </div>
  <div class="section-body">

    <div class="row">
      <div class="col-12">
        <div class="card mb-0">
          <div class="card-body">
            <ul class="nav nav-pills">
              <li class="nav-item">
                <a class="nav-link ${!filterStatus ? 'active' : ''}" href="/machines/views">Todos <span class="badge badge-white">${counts.totalCount}</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link ${filterStatus === 'Em chamado' ? 'active' : ''}" href="/machines/views?status=Em chamado">Em chamado <span class="badge badge-warning">${counts.pendingCount}</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link ${filterStatus === 'Em Uso' ? 'active' : ''}" href="/machines/views?status=Em Uso">Em Uso <span class="badge badge-success">${counts.inUseCount}</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link ${filterStatus === 'Em Manutenção' ? 'active' : ''}" href="/machines/views?status=Em Manutenção">Em Manutenção <span class="badge badge-danger">${counts.maintenanceCount}</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link ${filterStatus === 'Em estoque' ? 'active' : ''}" href="/machines/views?status=Em estoque">Em estoque <span class="badge badge-brown">${counts.maintenanceCount}</span></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h4>Cadastros</h4>
          </div>
          <div class="card-body">
            <div class="float-left">
              <select class="form-control selectric">
                <option>Action For Selected</option>
                <option>Move to Draft</option>
                <option>Move to Pending</option>
                <option>Delete Permanently</option>
              </select>
            </div>
            <div class="float-right">
              <form method="GET" action="/machines/views">
                <div class="input-group">
                  <input type="text" class="form-control" name="search" placeholder="Search" value="${search || ''}" />
                  <div class="input-group-append">
                    <button class="btn btn-primary">
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>

            <div class="clearfix mb-3"></div>

            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th class="pt-2">
                      <div class="custom-checkbox custom-control">
                        <input type="checkbox" data-checkboxes="mygroup" data-checkbox-role="dad"
                          class="custom-control-input" id="checkbox-all" />
                        <label for="checkbox-all" class="custom-control-label"></label>
                      </div>
                    </th>
                    <th>Nome</th>
                    <th>Etiqueta</th>
                    <th>Cliente</th>
                    <th>Cadastrado em</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  ${machines.map(machine => `
                  <tr id="machine-row-${machine.id}">
                    <td>
                      <div class="custom-checkbox custom-control">
                        <input type="checkbox" data-checkboxes="mygroup" class="custom-control-input"
                          id="checkbox-${machine.id}" />
                        <label for="checkbox-${machine.id}" class="custom-control-label">&nbsp;</label>
                      </div>
                    </td>
                    <td title="${machine.name}">${machine.name}
                      <div class="table-links">
                        <a href="#" title="Editar" data-toggle="modal" data-target="#editMachineModal"
                          onclick="editMachine('${machine.id}', '${machine.name}', '${machine.tags}', '${machine.client}', '${machine.status}', '${machine.description}', '${machine.images}')">
                          <i class="fas fa-edit"></i>
                        </a>
                        <a href="#" class="text-danger delete-machine" data-id="${machine.id}" title="Deletar">
                          <i class="fas fa-trash-alt"></i>
                        </a>
                      </div>
                    </td>
                    <td>${machine.tags}</td>
                    <td>
                      <a href="#">
                        <img alt="image" src="../../assets/img/avatar/avatar-5.png" class="rounded-circle" width="35"
                          data-toggle="title" title="" />
                        <div class="d-inline-block ml-1">${machine.client}</div>
                      </a>
                    </td>
                    <td>${new Date(machine.createdAt).toLocaleDateString()}</td>
                    <td>
                      <div class="badge status-badge">${machine.status}</div>
                    </td>
                  </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>

            <div class="float-right">
              <nav>
                <ul class="pagination">
                  ${Array.from({ length: totalPages }, (_, i) => i + 1).map(page => `
                  <li class="page-item ${currentPage === page ? 'active' : ''}">
                    <a class="page-link" href="/machines/views?page=${page}&search=${search || ''}">${page}</a>
                  </li>
                  `).join('')}
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </section>

  <!-- Modal de Edição -->
  <div class="modal fade" id="editMachineModal" tabindex="-1" aria-labelledby="editMachineModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editMachineModalLabel">Editar Máquina</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="editMachineForm" enctype="multipart/form-data">
            <input type="hidden" id="editMachineId" name="id">

            <div class="form-group">
              <label for="editName">Nome</label>
              <input type="text" class="form-control" id="editName" name="name" required>
            </div>

            <div class="form-group">
              <label for="editTags">Etiqueta</label>
              <input type="text" class="form-control" id="editTags" name="tags" required>
            </div>

            <div class="form-group">
              <label for="editClient">Cliente</label>
              <input type="text" class="form-control" id="editClient" name="client" required>
            </div>

            <div class="form-group">
              <label for="editStatus">Status</label>
              <select class="form-control" id="editStatus" name="status" required>
                <option value="Em Manutenção">Em Manutenção</option>
                <option value="Em Uso">Em Uso</option>
                <option value="Em chamado">Em chamado</option>
                <option value="Em estoque">Em estoque</option>
              </select>
            </div>

            <div class="form-group">
              <label for="editDescription">Descrição</label>
              <textarea class="form-control" id="editDescription" name="description" rows="3"
                style="height: 100px;"></textarea>
            </div>

            <div class="form-group">
              <label for="editImages">Imagens</label>
              <input type="file" class="form-control-file" id="editImages" name="images" multiple>
            </div>

            <div id="editImagePreview" class="row md-3">
            </div>

            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
          </form>
        </div>
      </div>
    </div>
  </div>



  `;
  %>

  <% const additionalStyles=` <link rel="stylesheet" href="../../../node_modules/selectric/public/selectric.css">

    `;
    %>

    <% const additionalScripts=` <script src="../../../assets/js/page/deleteMachine.js">
      </script>
      <script src="../../../node_modules/selectric/public/jquery.selectric.min.js"></script>
      <script src="../../../assets/js/page/machines.js"></script>
      `;
      %>

      <%- include('layouts/master.ejs', { bodyContent: bodyContent, additionalScripts:additionalScripts,
        additionalStyles:additionalStyles })  %>